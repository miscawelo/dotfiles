#!/usr/bin/env sh

sink="$(pamixer --list-sinks | awk -F '"' '/Running/ {print $6}')"
btStatus="$(pamixer --list-sinks | awk '/bluez/')"
icon="$HOME/bin/assets/icons/"

send_notif() {
  volume=$(pamixer --get-volume)

  if [ -n "$btStatus" ]; then
    icon=$icon"bluetooth.png"
  else
    if [ "$(pamixer --get-mute)" = "true" ]; then
      icon=$icon"volumeMute.png"
    elif [ "$volume" -gt 66 ]; then
      icon=$icon"volumeHigh.png"
    elif [ "$volume" -gt 33 ]; then
      icon=$icon"volumeMed.png"
    elif [ "$volume" -gt 0 ]; then
      icon=$icon"volumeLow.png"
    else
      icon=$icon"volumeOff.png"
    fi
  fi

  dunstify "Volume" "$sink" -a "System" -i "$icon" -h string:x-dunst-stack-tag:volume -h int:value:"$volume"
}

[ "$1" = "down" ] && pamixer -u && pamixer -d "$2" && send_notif && exit
[ "$1" = "up" ] && pamixer -u && pamixer -i "$2" && send_notif && exit
[ "$1" = "set" ] && pamixer -u && pamixer --set-volume "$2" && send_notif "$1" && exit
[ "$1" = "mute" ] && pamixer -m && send_notif && exit
