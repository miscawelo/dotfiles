#!/usr/bin/env sh

path="$HOME/Pictures/Screenshots/"
schema="$(date +"%Y%m%d_%H%M%S")"

[ ! -d path$ ] && mkdir -p "$path"

[ "$1" = "quick" ] && \
  grim "$path$schema.png" && \
  dunstify "Screenshot taken" "Desktop captured" -i "$(find "$path" | tail -n1)" -h string:x-dunst-stack-tag:screenshot_"$1" && \
  wl-copy < "$path$schema.png" && \
  exit
[ "$1" = "selection" ] && \
  grim -g "$(slurp)" "$path$schema.png" && \
  dunstify "Screenshot taken" "Selection captured" -i "$(find "$path" | tail -n1)" -h string:x-dunst-stack-tag:screenshot_"$1" && \
  wl-copy < "$path$schema.png" && \
  exit
[ "$1" = "ocr" ] && \
  grim -g "$(slurp)" "tesseract.png" && \
  tesseract "tesseract.png" - | wl-copy && \
  rm "tesseract.png" && \
  dunstify "Text scanned" "$(wl-paste)" -h string:x-dunst-stack-tag:screenshot_"$1" && \
  exit
[ "$1" = "qr" ] && \
  grim -g "$(slurp)" "qr.png" && \
  zbarimg -q "qr.png" | wl-copy && \
  rm "qr.png" && \
  dunstify "QR code scanned" "$(wl-paste)" -h string:x-dunst-stack-tag:screenshot_"$1" && \
  exit
